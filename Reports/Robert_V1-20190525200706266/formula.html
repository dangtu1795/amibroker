<HTML><HEAD>
<TITLE>Robert_V1 - Backtest Report</TITLE><STYLE>
<!--
BODY { font-family:"Tahoma,Arial,Helvetica,Sans Serif"; font-size:8pt; }
TD {  font-size:8pt; text-align: right; white-space: nowrap; }
TH {  font-size:8pt; text-align: left; font-weight: normal; }
.CH { text-align: right; font-weight:bold; }
.CHL { text-align: left; font-weight:bold; }
.BIG { font-size:10pt; font-weight:bold; text-align: center; }
.TAB { font-size:10pt;  text-align: center; text-color:#CCCCCC; }
.SELTAB { font-size:10pt; font-weight:bold; text-align: center; text-color:#000000; }
.good { color:#006600; }
.bad { color:#880000; }
.neut { color:#000088; }
a:active { background-color:#DDDDFF; }
-->
</STYLE>
<SCRIPT>
var curPart = 0;
function showPart( i )
{
	 document.getElementById("part" + curPart ).style.display = "none";
	 document.getElementById("part" + i ).style.display = "";
	 curPart = i;
}
</SCRIPT>
</HEAD>
<BODY>
<DIV ALIGN=CENTER><FONT class='TAB'><a href='stats.html'>Statistics</a> | <a href='charts.html'>Charts</a> | <a href='trades.html'>Trades</a> | <a href='formula.html'><FONT class='SELTAB'>Formula</FONT></a> | <a href='settings.html'>Settings</a> | <a href='symbols.html'>Symbols</a> | <a href='montecarlo.html'>Monte Carlo</a></FONT></DIV><br>
<TABLE CELLSPACING=0 CELLPADDING=2 WIDTH=100%>
<TR bgcolor="#DDDDDD"><TH COLSPAN=5 CLASS="BIG" >Formula</TH></TR>
</TABLE><PRE> 
_SECTION_BEGIN("robert all in one"); 
GfxSetBkMode(1); 
X=750; 
Y=20; 
Font=8; 
GfxSelectFont("Impact",Font*2.2, 550);GfxSetTextColor(colorRed);GfxTextOut("Robert All In One",x,y); 
_SECTION_END(); 
 
//------------------------------------------------------------------------------ 
 
 
_SECTION_BEGIN("Bollinger Bands"); 
_N(Title = StrFormat("{{NAME}} - {{INTERVAL}} {{DATE}} Open %g, Hi %g, Lo %g, Close %g (%.1f%%) {{VALUES}}", O, H, L, C, SelectedValue( ROC( C, 1 ) ) )); 
SetBarFillColor( IIf( C&gt;O, colorGreen, colorRed ) );  
Plot( C, "Close", colorBlack, styleNoTitle | ParamStyle("Style") | GetPriceStyle() );  
 
 
P = ParamField("Price field",-1); 
Periods = Param("Periods", 15, 2, 300, 1 ); 
Width = Param("Width", 2, 0, 10, 0.05 ); 
Color = ParamColor("Color", colorCycle ); 
Style = ParamStyle("Style"); 
bbtop=BBandTop( P, Periods, Width ); 
bbbot=BBandBot( P, Periods, Width ); 
bbmid = (bbbot+bbtop)/2; 
Plot(bbtop, "BBTop" + _PARAM_VALUES(), Color, Style );  
Plot(bbbot , "BBBot" + _PARAM_VALUES(), Color, Style ); 
Plot(bbmid , "BBMid" + _PARAM_VALUES(), Color, Style ); 
diff=bbtop-bbbot; 
flagPercent = 9.5; 
diffPercent = (diff/bbtop)*100; 
sqeezcolor=ColorRGB(194,220,218); 
expandcolor=ColorRGB(255,220,218); 
 
 
 
 
wma5 = WMA(Close, 5); 
// draw wma5 
Plot(wma5, "Wma5",colorBrown,styleLine); 
 
//Plot( diff, "Diff", colorGreen, Style );  
 
/////// Filter 
// Gia cat len duong WMA 5 ngay 
Con1 = Close &gt; wma5;  
 
// EMA 3 ngay cat len WMA 5 ngay. 
ema3 = EMA(Close,3); 
Plot(ema3, "ema3",colorBlueGrey,styleLine); 
Con2 = ema3/wma5 &gt;= 1.0009; 
 
// Vol giao dich tai thoi diem loc cho tin hieu &gt;= 80% vol giao dich  trung binh 10 phien truoc do. 
AvgVolume = MA(Volume, 10); 
Con3 = Volume &gt;= (AvgVolume*0.2); 
 
// Duong MACD huong len tren. 
macd1 = Ref (MACD (), -1); 
macd2 = Ref(MACD(), -2); 
Con4 = MACD() &gt; -0.017 AND (MACD() &gt;= macd1) AND macd1/macd2 &gt; 0.9405; 
WriteVal(MACD()); 
WriteVal(macd1/macd2, 10.6); 
WriteVal(MACD()); 
Plot(MACD(),"MACD",colorCustom16, styleLeftAxisScale); 
// vol lon hon 30k 
Con5 = Volume &gt; 10000 OR C &gt; 80; 
 
// Kiem tra BB hep 
Con6 = diffPercent &lt; flagPercent; 
// Kiem tra BB phai di ngang hoac huong len 
Con6_1 = (bbtop / Ref(bbtop, -1)) &gt; 0.99;// AND ((bbbot / Ref(bbbot, -1)) &gt; 0.99) ; 
 
// Gia dong cua (gia tai thoi diem kiem tra) phai lon hon gia mo cua 
Con7 = Close &gt; Open; //Close &gt; Ref(Close, -1); 
 
// DK sell, khi gia dong cua cat xuong duong WMA 5 ngày 
Con8 =  wma5 &gt; Close; 
 
// check Mid BB 
Con9 = Open &lt;= bbmid; 
 
 
//Doji checking  
//1. 2 nen phia truoc phai la Doji 
//2. gia phai lon hon gia cao nhat cua 2 doji phia truoc. 
//smallBodyMaximum=0.0025;//less than 0.25% 
/* Doji Yesterday - (DY)*/ 
//DY = abs(Ref ( C, -1)-Ref(O,-1)) &lt;= Ref ( C, -1) *smallBodyMaximum OR abs (Ref ( O, -1)-Ref(C,-1)) &lt;= (Ref ( H, -1 ) - Ref ( L, -1 ) )*0.1; 
/* Doji 2 days ago - (DYY)*/ 
//DYY = abs(Ref ( C, -2)-Ref(O,-2)) &lt;= Ref ( C, -2) *smallBodyMaximum OR abs (Ref ( O, -2)-Ref(C,-2)) &lt;= (Ref ( H, -2 ) - Ref ( L, -2 ) )*0.1; 
//highestDojiValue  = IIf(Ref(H, -1) &gt; Ref(H, -2), Ref(H,-1), Ref(H, -2)); 
  
//ConDoji = DY AND DYY  
//AND (C &gt; highestDojiValue)  
//AND V &gt; 20000 
//AND V &gt; Ref(V, -1) 
//AND Con5; 
 
BuyRB = Con1 AND Con2 AND Con3  
AND Con4 AND Con5  
AND Con6 AND Con6_1 AND Con7 
AND Con9; 
WriteVal(Con9); 
//OR ConDoji; 
Buy = BuyRB; 
//Plot(Con6_1,"con", colorWhite, styleLine );  
 
WriteIf(Con1,"Close &gt; wma5", "fail: Close &gt; wma5"); 
WriteIf(Con2, "EMA 3 ngay cat len WMA 5 ngay", "Fail: EMA 3 ngay cat len WMA 5 ngay"); 
WriteIf(Con3, "Volume &gt;= (AvgVolume*0.8);", "Fail:  Volume &gt;= (AvgVolume*0.8);"); 
WriteIf(Con4, "Duong MACD huong len tren.", "Fail: Duong MACD huong len tren."); 
WriteIf(Con5, "Volume &gt; 20000;", "Fail:  Volume &gt; 20000;"); 
WriteIf(Con6, "BB hep", "Fail: BB hep"); 
WriteIf(Con6_1, "Kiem tra BB phai di ngang hoac huong len", "Fail: Kiem tra BB phai di ngang hoac huong len"); 
WriteIf(Con7, "Close &gt; Open;", "Fail: Close &gt; Open;"); 
WriteIf(Con9, "Open &lt;= bbmid;", "Fail: Open &lt;= bbmid;"); 
//WriteIf(ConDoji, "Thoa Doji 3 phien", "Fail: Thoa Doji 3 phien"); 
 
//Sell = Con8; 
// smart trading system 
A = DEMA(C,2); 
BH = DEMA(a,34)+2*(StDev(a,34)); 
BL = DEMA(a,34)-2*(StDev(a,34)); 
BM = (BH+BL)/2; 
Highs = TEMA(High, 30); 
Lows = TEMA(Low, 30); 
A = DEMA(L,2); 
BH = DEMA(A,34)+2*(StDev(A,34)); 
BL = DEMA(A,34)-2*(StDev(A,34)); 
BM = (BH+BL)/2; 
A = DEMA(H,2); 
BH = DEMA(A,34)+2*(StDev(A,34)); 
BL = DEMA(A,34)-2*(StDev(A,34)); 
UpTrend = C &gt; Highs; 
DnTrend = C &lt; Lows ; 
BM1 = (BH+BL)/2; 
Sell=Cross(BM,C); 
//Buy=Cross(C,BM1); 
//Buy=ExRem(Buy,Sell); 
Sell=ExRem(Sell,Buy); 
 
 
 
Filter = Buy &gt; 0;//OR Sell; 
 
AddColumn( Close, "Close " ); 
AddColumn( Volume,"Volume " ); 
//AddColumn(ConDoji, "Doji "); 
//AddColumn(Iff(Buy &gt; 0, Buy,"Action ")); 
//AddColumn( Con6, "BB"); 
// gui ket qua ve telegram 
/* 
if(LastValue(Filter) ) { 
	message = "name=" + Name() + "&date=" + Date() + "&price=" + Close; 
	//hURL	= InternetOpenURL("https://api.telegram.org/bot878637551:AAEZ1AoVeEOKVfkezOhFsXHvQxzQrMPIxNU/sendMessage?chat_id=-1001445799293&text="+ message); 
	hURL	= InternetOpenURL("http://172.104.47.247:9944/api/updatestock?" + message); 
	InternetClose(hURL); 
}*/ 
 
// draw on chart 
PlotShapes(IIf(BuyRB, shapeHollowUpArrow, shapeNone), colorGreen, 0,L, Offset=-45); 
//PlotShapes(IIf(ConDoji, shapeHollowUpArrow, shapeNone), colorYellow, 0,L, Offset=-65);  
PlotShapes(IIf(Sell, shapeHollowDownArrow, shapeNone),colorRed, 0, H, Offset=-35); 
//Colors = IIf(UpTrend, colorGreen, IIf(DnTrend, colorRed, colorLightGrey)); 
 
// fill color for BB 
PlotOHLC( bbtop,bbtop, bbbot,bbbot, "BB",IIf(diffPercent &lt; flagPercent,sqeezcolor,expandcolor), styleCloud );  
_SECTION_END(); 
 
 
 

</PRE></BODY></HTML>